<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
    <link rel="stylesheet" href="js/lib/dojo/dijit/themes/claro/claro.css" />
    <link rel="stylesheet" href="css/main.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a062562745.js" crossorigin="anonymous"></script>
    <title>Pokedex Dojo</title>

    <!-- Dojo Config e import -->
    <script>
        var dojoConfig = {
            parseOnLoad: 1,
            async: true,
            packages: [{
                name: "js",
                location: location.pathname.replace(/\/[^/]*$/, "") + "/js",
            }, ],
        };
    </script>
    <script src="js/lib/dojo/dojo/dojo.js"></script>



</head>

<body class="claro">

    <div id="appLayout" class="demoLayout" data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design: 'headline'">
        <div class="centerPanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'center'">

            <div class="panel">
                <div id="buscador" class="container">
                    <div class="row">
                        <div class="col-12 col-md-8">
                            <br/>
                            <br/>
                            <h4 style="background-color: rgba(250, 235, 215, 0.301);font-size:4vw;">Escriba el nombre del pokemon</h4>
                            <input id="pokemonName" name="pokemonSelect" data-dojo-props="
                        value: '',
                        placeHolder: 'Select a Pokemon'" />

                            <br/>
                            <br/>
                            <div>
                                <h4><button id="botonRefresh" class="btn btn-danger">Click para hacer el request</button></h4>

                            </div>
                            <div id="tabla" style="width: 100%;"></div>
                        </div>
                        <div class="col-auto" style="left: 20px;">
                            <div id="musica"></div>
                            <br/>
                            <br/>
                            <button id="tienda" class="btn btn-danger">Click para ir a la tienda</button>
                        </div>

                    </div>
                </div>

            </div>
            <div class="panel">

                <div id="tiendaContainer" class="container" style="opacity: 0;">


                </div>
            </div>
        </div>

        <div class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'top'">
            <div class="top">
                <table class="table table-hover  table-responsive table-condensed 'border= 1px;'" style="border: 0cm; height: 100%;">
                    <tr>
                        <td style="border: 0cm; background-color: rgb(0, 4, 7); vertical-align: middle; ">
                            <a href="https://dojotoolkit.org/"><img id="dojo" class="mediana" alt="dojo-toolkit" src='images/96_dojo-toolkit.be45374836.png' /></a>
                        </td>
                        <td rowspan="2" style="border: 0cm; width: 40%;">
                            <h1 style="font-size:5vw;">Pokeapi dojo</h1>
                            <a href="https://pokeapi.co/"><img class="mediana" alt="Pokeapi" src='images/pokeapi_256.888baca4.png' /></a>
                        </td>
                        <td style="border: 0cm; background-color: rgb(253, 6, 6); vertical-align: middle; width: 20%;">
                            <a href="https://github.com/AlmadaBraian/dojoProyect"><img class="pequeÃ±a" alt="Pokeapi-repository" src='images/25231.png' /></a>
                        </td>
                    </tr>

                    <tr>
                        <td style="border: 0cm; background-color: rgb(253, 6, 6);"></td>
                        <td style="border: 0cm; background-color: rgb(14, 13, 13);"></td>
                    </tr>


                </table>
            </div>
        </div>

    </div>
    <!-- Funciones Dojo -->
    <script>
        // Para hacer la solicitud a la API importar la funcion "dojo/request"
        require(["dojo/dom", "dojo/on", "dojo/mouse", "dojo/request", "dijit/layout/BorderContainer", "dijit/layout/TabContainer",
            "dijit/layout/ContentPane", "dojo/store/Memory", "dojo/json",
            "dojo/when", "dojo/Deferred", "dijit/form/FilteringSelect", "dojo/dom-construct", "dojo/html", 'dojo/fx', "dojo/dom-style", "js/tienda", "dojo/_base/fx", "js/app", "dojo/domReady!"
        ], function(dom, on, mouse, request, BorderContainer, TabContainer, ContentPane, Memory, json, when, Deferred, FilteringSelect, domConstruct, html, coreFx, domStyle, tienda, fx, app) {

            let botonRefresh = dom.byId("botonRefresh");
            let botonTienda = dom.byId('tienda');
            let contenedor = dom.byId('buscador');
            let contenedorTienda = dom.byId('tiendaContainer');
            let botonTest = dom.byId("botonTest");
            let tabla = dom.byId("tabla");
            let test = dom.byId("test");
            let pokeArray = [];

            const url = "https://pokeapi.co/api/v2/pokemon/";


            //let test2 = "<option>" + url + "</option>";
            //options.innerHTML = test2;

            function irTienda() {

                domStyle.set(contenedor, "opacity", "1");
                var fadeArgs = {
                    node: contenedor,
                    duration: 500,
                };
                fx.fadeOut(fadeArgs).play();

                coreFx.slideTo({
                    node: contenedor,
                    left: "1500",
                }).play();

                setTimeout(function() {
                    domStyle.set("tiendaContainer", "opacity", "0");
                    var fadeArgs = {
                        node: "tiendaContainer",
                        duration: 4000,
                    };
                    fx.fadeIn(fadeArgs).play();

                }, 1000);
                coreFx.slideTo({
                    node: contenedor,
                    bottom: "1500",
                    right: "1500"
                }).play();


                //domStyle.set("tiendaContainer", "opacity", "1");

                //setTimeout(function() {
                //  domConstruct.destroy(contenedor);
                //}, 2000);


            }

            function setOptions() {
                var deferred = new Deferred();
                let pokenombres = [];
                return request.get(`https://pokeapi.co/api/v2/pokemon/?limit=-1`, {
                        handleAs: "json"
                    })
                    .then(
                        function(response) {

                            listaPokemon = response.results;

                            //listaPokemon = response.results;
                            let cont = 1;
                            const nombres = listaPokemon.map((pokemon) => pokemon.name).forEach(element => {
                                pokenombres.push({

                                    name: element,
                                    value: element
                                });
                                cont++;
                            });
                            return pokenombres
                        })
                return pokenombres
            }

            when(setOptions(), function obtenerPokemones(pokenombres) {
                var pokeStore = new Memory({
                    data: pokenombres
                });
                var filteringSelect = new FilteringSelect({
                    id: "pokeStore",
                    name: "pokemons",
                    value: "",
                    store: pokeStore,
                    searchAttr: "name"
                }, "pokemonName");
            })

            //options.innerHTML = "<option>pokemon</option>"
            // let opcion = "<option>" + element + "</option>";
            //poke.innerHTML = opcion;})

            function searchPokemon() {
                var pokemonId = dom.byId("pokeStore").value;
                var abilidades = dom.byId("abilidades");
                request.get(url + pokemonId, {
                        handleAs: "json"
                    })
                    .then(
                        function(res) {
                            //console.log(res.abilities[0].ability.name)
                            res.abilities.forEach(element => {
                                console.log(element.ability.name)
                            });

                            var ht = "<table class=`table table-hover  table-responsive table-condensed` border= `1px;`><thead><tr style='font-size:1.5vw;'><th scope=`col`>Nombre</th><th scope=`col`>Altura</th><th scope=`col`>Peso</th><th scope=`col`>Tipo</th><th scope=`col`>Batallas</th><th scope=`col`>Sprite</th></tr></thead>";
                            const pokeObjeto = {
                                id: res.id,
                                Nombre: res.name,
                                Tipo: res.types[0].type.name,
                                Altura: Math.round(res.height * 10),
                                Peso: Math.round(res.weight / 10),
                                Batallas: res.game_indices.length,
                                Frente: res.sprites.front_default,
                                Espalda: res.sprites.back_default,
                            };
                            pokeArray.push(pokeObjeto);
                            let cont = 0;
                            pokeArray.forEach(element => {
                                let background = "";
                                if (cont % 2 == 0) {
                                    background = "background-color: rgb(253, 6, 6);"
                                } else {
                                    background = "background-color: rgb(0, 4, 7);"
                                }

                                ht = ht + "<tr style='" + background + ";color: #fff; font-size:2vw;'>";
                                ht = ht + "<td scope='row' >" + element.Nombre + "</td>";
                                ht = ht + "<td scope='row'>" + element.Altura + "cm" + "</td>";
                                ht = ht + "<td scope='row'>" + element.Peso + "kg" + "</td>";
                                ht = ht + "<td scope='row'>" + element.Tipo + "</td>";
                                ht = ht + "<td scope='row'>" + element.Batallas + "</td>";
                                ht = ht + "<td scope='row'>" + `<img src="${element.Frente}" alt="" style='width: 120%; height: auto;'></td>`;
                                ht = ht + "</tr>";
                                cont++;
                            });
                            ht = ht + "</table>";
                            html.set(tabla, ht, {
                                    parseContent: true
                                })
                                //tabla.innerHTML = html;

                        })
            }

            //dojo.destroy("dijit_form_FilteringSelect_0");


            //obtenerPokemones()
            // Funcion de evento click izquierda
            // params (target, event, function)
            on(document, "keyup", function(event) {
                if (event.keyCode == 13) {
                    var pokemonId = dom.byId("pokeStore").value;
                    if (pokemonId != "") {
                        searchPokemon();
                    }

                }
            });
            on(botonRefresh, "mousedown", function(event) {
                if (mouse.isLeft(event)) {
                    searchPokemon();

                }
            });
            on(botonTienda, "mousedown", function(event) {
                if (mouse.isLeft(event)) {
                    irTienda();

                }
            });
        });
    </script>
</body>

</html>